name: Build project

on: [push, pull_request]

jobs:
    buildForWebGL:
        name: Build for ${{ matrix.targetPlatform }}
        runs-on: ubuntu-latest
        strategy:
            fail-fast: false
            matrix:
                targetPlatform:
                    - WebGL
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4
              with:
                fetch-depth: 0
                lfs: true
            
            - name: Caching unity project folders
              uses: actions/cache@v3
              with:
                path: ${{ vars.PROJECT_ROOT_PATH }}/Library
                key: ${{ vars.PROJECT_ROOT_PATH }}/Library-${{ hashFiles('Assets/**', 'Packages/**', 'ProjectSettings/**') }}
                restore-kets: Library-
                    
            - name: Build unity project
              uses: game-ci/unity-builder@v4
              env:
                UNITY_LICENSE: ${{ secrets.UNITY_LICENSE }}
                UNITY_EMAIL: ${{ secrets.UNITY_EMAIL }}
                UNITY_PASSWORD: ${{ secrets.UNITY_PASSWORD }}
              with:
                projectPath: ${{ vars.PROJECT_ROOT_PATH }}
                targetPlatform: ${{ matrix.targetPlatform }}
            
            - name: Upload build to artifacts
              uses: actions/upload-artifact@v3
              with:
                name: Build-${{ matrix.targetPlatform }}
                path: build/${{ matrix.targetPlatform }}
